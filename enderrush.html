<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>EnderRush</title>
  <style>
    body {
  margin: 0;
  background: linear-gradient(135deg, #7aa9c1, #6b8aa2);
  font-family: sans-serif;
  color: white;
  text-align: center;
}

/* ØµÙØ­Ø§Øª */
.screen {
  display: none;
  height: 100vh;
  width: 100vw;
  justify-content: center;
  align-items: center;
  flex-direction: column;
}

.screen.active {
  display: flex;
}

/* Ø¨Ø§Ù„Ø§ÛŒ ØµÙØ­Ù‡ */
.top-bar {
  position: absolute;
  top: 20px;
  width: 100%;
  display: flex;
  justify-content: space-between;
  padding: 0 30px;
  font-size: 24px;
}

.settings {
  font-size: 40px;
  cursor: pointer;
}

/* Ù„ÙˆÚ¯Ùˆ */
.logo {
  font-size: 70px;
  margin-top: 80px;
  margin-bottom: 30px;
  color: #ffcc00;
  text-shadow: 0 0 15px #ff6600, 0 0 30px #ff3300;
}

/* Ú©Ø§Ø±Ø§Ú©ØªØ± */
.character-info {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
}
.character-img {
  width: 150px;
}
.copy-btn {
  margin-left: 10px;
  cursor: pointer;
  font-size: 20px;
}

/* ÙØ±ÙˆØ´Ú¯Ø§Ù‡ */
.store {
  margin-top: 30px;
}
.store-items {
  display: flex;
  gap: 15px;
  margin-top: 15px;
}
.store-btn {
  padding: 15px 20px;
  border-radius: 10px;
  border: none;
  font-size: 18px;
  cursor: pointer;
  transition: 0.3s;
}
.store-btn:hover {
  transform: scale(1.1);
}
.clothes { background: #e91e63; }
.gadgets { background: #2196f3; }
.cars { background: #ff9800; }
.pets { background: #4caf50; }
.coins-rubies { background: #9c27b0; }

/* Ø¯Ú©Ù…Ù‡ Ø´Ø±ÙˆØ¹ */
.start-btn {
  margin-top: 50px;
  padding: 20px 50px;
  font-size: 28px;
  border: none;
  border-radius: 20px;
  background: #00e5ff;
  color: #000;
  cursor: pointer;
  transition: 0.3s;
  box-shadow: 0 0 15px #00e5ff;
}
.start-btn:hover {
  background: #ff4081;
  color: white;
  transform: scale(1.1);
}

/* ØµÙØ­Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ø­Ø§Ù„Øª */
.mode-container {
  display: flex;
  width: 90%;
  height: 90%;
}
.right-side, .left-side {
  flex: 1;
  display: flex;
  justify-content: center;
  align-items: center;
}
.city-btn {
  width: 80%;
  height: 80%;
  font-size: 40px;
  background: #ff5722;
  color: white;
  border: none;
  border-radius: 20px;
  cursor: pointer;
  transition: 0.3s;
}
.city-btn:hover {
  transform: scale(1.05);
  background: #ff7043;
}
.grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 15px;
}
.grid button {
  padding: 40px;
  font-size: 20px;
  border: none;
  border-radius: 10px;
  background: #555;
  color: #aaa;
}

/* Ø¯Ú©Ù…Ù‡ Ø¨Ø±Ú¯Ø´Øª Ø¯Ø± ØµÙØ­Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ù…ÙˆØ¯ */
.back-btn {
  position: absolute;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  padding: 15px 30px;
  font-size: 24px;
  border: none;
  border-radius: 15px;
  background: #555;
  color: white;
  cursor: pointer;
  transition: 0.3s;
}
.back-btn:hover {
  background: #777;
  transform: translateX(-50%) scale(1.05);
}

/* Ù„ÙˆØ¯ÛŒÙ†Ú¯ */
.loading-text {
  font-size: 40px;
  color: #ffcc00;
  text-shadow: 0 0 15px #ff6600, 0 0 30px #ff3300;
}

/* Ù¾Ø§Ù¾â€ŒØ¢Ù¾ */
.popup {
  display: none;
  position: fixed;
  z-index: 10;
  background: rgba(0,0,0,0.8);
  width: 100%;
  height: 100%;
  justify-content: center;
  align-items: center;
}
.popup-content {
  background: #222;
  padding: 30px;
  border-radius: 15px;
  text-align: center;
}
.popup input {
  padding: 10px;
  margin: 10px 0;
  width: 200px;
}
.popup button {
  padding: 10px 20px;
}

/* Ù¾Ù†Ù„ Ù„Ø¨Ø§Ø³â€ŒÙ‡Ø§ */
.clothes-content {
  width: 80%;
  max-width: 800px;
  max-height: 80vh;
  overflow-y: auto;
}
.tabs {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin-bottom: 20px;
}
.tab-btn {
  padding: 10px 20px;
  background: #555;
  border: none;
  border-radius: 5px;
  color: white;
  cursor: pointer;
}
.tab-btn.active {
  background: #e91e63;
}
.tab-content {
  display: block;
}
.skins-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 20px;
  margin-top: 20px;
}
.skin-item {
  background: #333;
  padding: 10px;
  border-radius: 10px;
  text-align: center;
  transition: 0.3s;
}
.skin-item:hover {
  transform: scale(1.05);
  box-shadow: 0 0 10px #e91e63;
}
.skin-item h4 {
  margin: 10px 0 5px;
  font-size: 16px;
}
.skin-item p {
  margin: 5px 0;
  font-size: 14px;
  color: #ffcc00;
}
.skin-buy-btn {
  padding: 8px 16px;
  background: #e91e63;
  border: none;
  border-radius: 5px;
  color: white;
  cursor: pointer;
  transition: 0.3s;
}
.skin-buy-btn:hover {
  background: #ff4081;
}
.close-btn {
  margin-top: 20px;
  padding: 10px 20px;
  background: #555;
  border: none;
  border-radius: 10px;
  color: white;
  cursor: pointer;
}

/* Ú†Ø±Ø®â€ŒØ¯Ù†Ø¯Ù‡ Ø¯Ø± Ø¨Ø§Ø²ÛŒ */
#game-settings {
  position: absolute;
  top: 20px;
  right: 20px;
  font-size: 40px;
  cursor: pointer;
}

/* Ù¾Ù†Ù„ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¯Ø± Ø¨Ø§Ø²ÛŒ */
#game-settings-popup .popup-content button {
  display: block;
  margin: 10px auto;
  padding: 10px 20px;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  font-size: 18px;
}
#close-settings {
  background: #555;
  color: white;
}
#exit-game {
  background: #ff5722;
  color: white;
}

/* Ø¢ÛŒØªÙ… Ø¨Ø§Ø± */
#item-bar {
  position: absolute;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 10px;
  background: rgba(0,0,0,0.5);
  padding: 10px;
  border-radius: 15px;
}
.item {
  width: 50px;
  height: 50px;
  background: #555;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 20px;
  border-radius: 5px;
  cursor: pointer;
  transition: 0.3s;
}
.item.active {
  transform: scale(1.3);
  border: 2px solid #00f;
}

/* Ø¨Ø§Ú©Ø³ Ø¨Ø§Ù„Ø§ÛŒ ØµÙØ­Ù‡ */
#player-box {
  position: absolute;
  top: 20px;
  right: 20px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  background: rgba(0,0,0,0.5);
  padding: 10px;
  border-radius: 10px;
}
.bar-container {
  width: 200px;
  background: #333;
  border-radius: 10px;
}
.bar-label {
  font-size: 14px;
  margin: 3px 0;
}
.bar {
  height: 15px;
  border-radius: 10px;
}
#health-bar { background: red; width: 100%; }
#energy-bar { background: blue; width: 100%; }
#hunger-bar { background: green; width: 100%; }

/* Ø¢ÛŒÚ©ÙˆÙ† Ù…ÙˆØ¨Ø§ÛŒÙ„ */
#mobile-icon {
  position: absolute;
  bottom: 20px;
  left: 20px;
  font-size: 24px;
  background: rgba(0,0,0,0.5);
  padding: 10px;
  border-radius: 50%;
}
  </style>
</head>
<body>
  <!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>Ender Rush</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ø«Ø¨Øª Ù†Ø§Ù… -->
  <div id="username-popup" class="popup">
    <div class="popup-content">
      <h2>Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ ğŸŒŸ</h2>
      <p>Ù„Ø·ÙØ§ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:</p>
      <input type="text" id="username-input" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ...">
      <button id="username-submit">ØªØ§ÛŒÛŒØ¯</button>
    </div>
  </div>

  <!-- Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ -->
  <div id="menu-screen" class="screen active">
    <div class="top-bar">
      <div class="settings">âš™ï¸</div>
      <div class="stats">
        <span>Ø³Ú©Ù‡: <b id="coins">500</b></span>
        <span>Ø±ÙˆØ¨ÛŒ: <b id="rubies">5</b></span>
      </div>
    </div>

    <h1 class="logo">ğŸŒŒ Ø§Ù†Ø¯Ø± Ø±Ø§Ø´ ğŸŒŒ</h1>

    <div class="character-info">
      <img src="https://i.ibb.co/3mhDpGc/mc-char.png" alt="Ú©Ø§Ø±Ø§Ú©ØªØ±" class="character-img" id="character-img">
      <div class="player-info">
        <h2 id="player-name">Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±</h2>
        <p>
          Ø¢ÛŒØ¯ÛŒ: <span id="player-id">#123456</span>
          <span id="copy-id" class="copy-btn">ğŸ“‹</span>
        </p>
      </div>
    </div>

    <div class="store">
      <h3>ÙØ±ÙˆØ´Ú¯Ø§Ù‡</h3>
      <div class="store-items">
        <button class="store-btn clothes">Ù„Ø¨Ø§Ø³â€ŒÙ‡Ø§</button>
        <button class="store-btn gadgets">Ù„ÙˆØ§Ø²Ù… Ù‡ÙˆØ´Ù…Ù†Ø¯</button>
        <button class="store-btn cars">Ø®ÙˆØ¯Ø±ÙˆÙ‡Ø§</button>
        <button class="store-btn pets">Ø­ÛŒÙˆØ§Ù†Ø§Øª</button>
        <button class="store-btn coins-rubies">Ø³Ú©Ù‡ Ùˆ Ø±ÙˆØ¨ÛŒ</button>
      </div>
    </div>

    <button id="main-start-btn" class="start-btn">Ø´Ø±ÙˆØ¹</button>
  </div>

  <!-- Ù¾Ù†Ù„ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ù„Ø¨Ø§Ø³â€ŒÙ‡Ø§ -->
  <div id="clothes-store" class="popup">
    <div class="popup-content clothes-content">
      <h2>ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ù„Ø¨Ø§Ø³â€ŒÙ‡Ø§ ğŸ‘•</h2>
      <div class="tabs">
        <button class="tab-btn active" data-tab="custom">Ú©Ø§Ø³ØªÙˆÙ…</button>
        <button class="tab-btn" data-tab="job">Ø´ØºÙ„ Ø¯Ø§Ø±</button>
        <button class="tab-btn" data-tab="special">ÙˆÛŒÚ˜Ù‡</button>
      </div>
      <div class="tab-content" id="custom-tab">
        <div class="skins-grid"></div>
      </div>
      <div class="tab-content" id="job-tab" style="display: none;">
        <div class="skins-grid"></div>
      </div>
      <div class="tab-content" id="special-tab" style="display: none;">
        <div class="skins-grid"></div>
      </div>
      <button id="close-clothes" class="close-btn">Ø¨Ø³ØªÙ†</button>
    </div>
  </div>

  <!-- ØµÙØ­Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ø­Ø§Ù„Øª -->
  <div id="mode-screen" class="screen">
    <div class="mode-container">
      <div class="right-side">
        <button id="enter-city" class="city-btn">ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø´Ù‡Ø±</button>
      </div>
      <div class="left-side">
        <div class="grid">
          <button disabled>Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ...</button>
          <button disabled>Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ...</button>
          <button disabled>Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ...</button>
          <button disabled>Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ...</button>
          <button disabled>Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ...</button>
          <button disabled>Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ...</button>
          <button disabled>Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ...</button>
          <button disabled>Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ...</button>
          <button disabled>Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ...</button>
        </div>
      </div>
    </div>
    <button id="back-to-menu" class="back-btn">Ø¨Ø±Ú¯Ø´Øª</button>
  </div>

  <!-- ØµÙØ­Ù‡ Ù„ÙˆØ¯ÛŒÙ†Ú¯ -->
  <div id="loading-screen" class="screen">
    <h2 class="loading-text">âœ¨ Ø¯Ø± Ø­Ø§Ù„ Ù„ÙˆØ¯ Ø´Ø¯Ù† Ø´Ù‡Ø± ... âœ¨</h2>
  </div>

  <!-- ØµÙØ­Ù‡ Ø¨Ø§Ø²ÛŒ -->
  <div id="game-screen" class="screen">
    <canvas id="game-canvas"></canvas>

    <!-- Ø¢ÛŒØªÙ… Ø¨Ø§Ø± Ù¾Ø§ÛŒÛŒÙ† ØµÙØ­Ù‡ -->
    <div id="item-bar">
      <div class="item" id="item1">1</div>
      <div class="item" id="item2">2</div>
      <div class="item" id="item3">3</div>
      <div class="item" id="item4">4</div>
      <div class="item" id="item5">5</div>
      <div class="item" id="item6">6</div>
      <div class="item" id="item7">7</div>
    </div>

    <!-- Ø¨Ø§Ú©Ø³ Ø¨Ø§Ù„Ø§ÛŒ ØµÙØ­Ù‡ -->
    <div id="player-box">
      <div id="player-info-box">
        <p id="player-name-game">Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±</p>
      </div>
      <div id="coins-rubies-box">
        <p>Ø³Ú©Ù‡: <span id="coins-game">500</span></p>
        <p>Ø±ÙˆØ¨ÛŒ: <span id="rubies-game">5</span></p>
      </div>

      <!-- Ù†ÙˆØ§Ø±Ù‡Ø§ -->
      <div class="bar-container">
        <div class="bar-label">Ø³Ù„Ø§Ù…ØªÛŒ: <span id="health-text">100 Ø§Ø² 100</span></div>
        <div class="bar" id="health-bar"></div>
      </div>
      <div class="bar-container">
        <div class="bar-label">Ø§Ù†Ø±Ú˜ÛŒ: <span id="energy-text">500 Ø§Ø² 500</span></div>
        <div class="bar" id="energy-bar"></div>
      </div>
      <div class="bar-container">
        <div class="bar-label">Ú¯Ø±Ø³Ù†Ú¯ÛŒ: <span id="hunger-text">50 Ø§Ø² 50</span></div>
        <div class="bar" id="hunger-bar"></div>
      </div>
    </div>

    <!-- Ø¢ÛŒÚ©ÙˆÙ† Ù…ÙˆØ¨Ø§ÛŒÙ„ -->
    <div id="mobile-icon">
      ğŸ“± G
    </div>

    <!-- Ú†Ø±Ø®â€ŒØ¯Ù†Ø¯Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¯Ø± Ø¨Ø§Ø²ÛŒ -->
    <div id="game-settings" class="settings">âš™ï¸</div>
  </div>

  <!-- Ù¾Ù†Ù„ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¯Ø± Ø¨Ø§Ø²ÛŒ -->
  <div id="game-settings-popup" class="popup">
    <div class="popup-content">
      <h2>ØªÙ†Ø¸ÛŒÙ…Ø§Øª</h2>
      <button id="close-settings">Ø¨Ø³ØªÙ†</button>
      <button id="exit-game">Ø®Ø±ÙˆØ¬</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/three@0.152.0/build/three.min.js"></script>
  <script src="script.js"></script>
</body>
</html>



  
  <script>
    // script.js â€” Ù†Ø³Ø®Ù‡Ù” Ú©Ø§Ù…Ù„ Ø´Ø¯Ù‡ Ø¨Ø§ Ù¾Ù†Ù„ Ø¨Ø§Ø²Ø±Ø³ÛŒ (Ø¢ÙÙ„Ø§ÛŒÙ†ØŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ)
// Ø­ÙØ¸ Ø´Ø¯Ù‡: Ù…Ù†ÙˆØŒ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…ØŒ Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒØŒ Ø³ÛŒØ³ØªÙ… Ø§Ø³ØªØ§Øªâ€ŒÙ‡Ø§ØŒ Ú©Ø§Ø±Ø§Ú©ØªØ±ØŒ Ø­Ø±Ú©ØªØŒ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ùˆ ...
// Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡: Ø¯Ú©Ù…Ù‡Ù” Ù¾Ù†Ù„ Ø¨Ø§Ø²Ø±Ø³ÛŒØŒ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ø¨Ø§ Ø¢ÛŒØ¯ÛŒ Ø¨Ø§Ø²Ø±Ø³ØŒ Ù¾Ù†Ù„ Ø§Ù†ØªØ®Ø§Ø¨ Ù¾Ù„ÛŒØ±ØŒ Ù†Ù…Ø§ÛŒØ´ Ù…Ø´Ø®ØµØ§Øª Ùˆ Ø¹Ù…Ù„ÛŒØ§Øª
// ÙˆÛŒØ±Ø§ÛŒØ´ Ø¬Ø¯ÛŒØ¯: Ù¾Ù†Ù„ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ù„Ø¨Ø§Ø³â€ŒÙ‡Ø§ Ø¨Ø§ ØªØ¨â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø³ØªÙˆÙ…ØŒ Ø´ØºÙ„ Ø¯Ø§Ø±ØŒ ÙˆÛŒÚ˜Ù‡ Ùˆ Ø§Ø³Ú©ÛŒÙ†â€ŒÙ‡Ø§ÛŒ Ù…Ø´Ø®Øµ
// ØªØºÛŒÛŒØ±Ø§Øª Ø¬Ø¯ÛŒØ¯: Ø±ÙØ¹ Ù…Ø´Ú©Ù„ Ø¨Ø§Ø² Ø´Ø¯Ù† ÙØ±ÙˆØ´Ú¯Ø§Ù‡ØŒ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ Ø¨Ø±Ú¯Ø´Øª Ø¯Ø± mode-screenØŒ Ù¾Ù†Ù„ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¯Ø± game-screen Ø¨Ø§ Ø¨Ø³ØªÙ† Ùˆ Ø®Ø±ÙˆØ¬

// ----- UI elements (Ù…Ø·Ø§Ø¨Ù‚ index.html) -----
const menuScreen = document.getElementById("menu-screen");
const modeScreen = document.getElementById("mode-screen");
const loadingScreen = document.getElementById("loading-screen");
const gameScreen = document.getElementById("game-screen");

const startBtn = document.getElementById("main-start-btn");
const enterCityBtn = document.getElementById("enter-city");
const backToMenuBtn = document.getElementById("back-to-menu"); // Ø¬Ø¯ÛŒØ¯: Ø¯Ú©Ù…Ù‡ Ø¨Ø±Ú¯Ø´Øª

const playerNameMenu = document.getElementById("player-name");
const playerIdEl = document.getElementById("player-id");
const copyBtn = document.getElementById("copy-id");

const usernamePopup = document.getElementById("username-popup");
const usernameInput = document.getElementById("username-input");
const usernameSubmit = document.getElementById("username-submit");

// Ø¬Ø¯ÛŒØ¯: Ù¾Ù†Ù„ Ù„Ø¨Ø§Ø³â€ŒÙ‡Ø§
const clothesBtn = document.querySelector('.store-btn.clothes');
const clothesStore = document.getElementById("clothes-store");
const closeClothes = document.getElementById("close-clothes");
const characterImg = document.getElementById("character-img");
const coinsEl = document.getElementById("coins");
const rubiesEl = document.getElementById("rubies");

// Ø¬Ø¯ÛŒØ¯: Ù¾Ù†Ù„ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¯Ø± Ø¨Ø§Ø²ÛŒ
const gameSettings = document.getElementById("game-settings");
const gameSettingsPopup = document.getElementById("game-settings-popup");
const closeSettings = document.getElementById("close-settings");
const exitGame = document.getElementById("exit-game");

// Ø¢ÛŒØªÙ… Ø¨Ø§Ø±
const itemEls = [];
for (let i = 1; i <= 7; i++) {
  const el = document.getElementById("item" + i);
  if (el) itemEls.push(el);
}

// Ù†ÙˆØ§Ø±Ù‡Ø§
const healthBarEl = document.getElementById("health-bar");
const energyBarEl = document.getElementById("energy-bar");
const hungerBarEl = document.getElementById("hunger-bar");
const healthTextEl = document.getElementById("health-text");
const energyTextEl = document.getElementById("energy-text");
const hungerTextEl = document.getElementById("hunger-text");

const playerNameGame = document.getElementById("player-name-game");
const coinsGame = document.getElementById("coins-game");
const rubiesGame = document.getElementById("rubies-game");

// ----- Game state -----
let HEALTH = 100;
let ENERGY = 500;
let HUNGER = 50;
let coins = 500, rubies = 5;

function generateID(){ return "#" + Math.floor(100000 + Math.random()*900000); }

// ---------- Offline players & inspectors (Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ) ----------
const players = [
  { id: generateID(), name: "PlayerOne", coins: 500, rubies: 5, blocked:false, warnings:0, criminalRecords:[], carImpounded:false, currentSkin: 'Ú¯Ù„ Ø¢Ù‚Ø§' },
  { id: generateID(), name: "PlayerTwo", coins: 340, rubies: 7, blocked:false, warnings:0, criminalRecords:[], carImpounded:false, currentSkin: 'Ú¯Ù„ Ø¢Ù‚Ø§' },
  { id: generateID(), name: "PlayerThree", coins: 50, rubies: 0, blocked:false, warnings:0, criminalRecords:[], carImpounded:false, currentSkin: 'Ú¯Ù„ Ø¢Ù‚Ø§' }
];
// currentPlayerIndex will be set to a player representing the user (default 0)
let currentPlayerIndex = 0;

// Ù„ÛŒØ³Øª Ø¢ÛŒØ¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²Ø±Ø³ Ù…Ø¬Ø§Ø² (Ù…Ø«Ø§Ù„). ØªÙˆ Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ø§ÛŒÙ†Ù‡Ø§ Ø±Ùˆ Ø¨Ù‡ Ù‡Ø± Ù…Ù‚Ø¯Ø§Ø±ÛŒ ØªØºÛŒÛŒØ± Ø¨Ø¯ÛŒ.
const inspectorIDs = ["INSPECTOR001","INSPECTOR002","INSPECTOR007"];

// helper: find player by id or name
function findPlayerById(id) { return players.find(p => p.id === id); }
function findPlayerByName(name) { return players.find(p => p.name === name); }

// ---------- Ø§Ø³Ú©ÛŒÙ†â€ŒÙ‡Ø§ Ø¨Ø§ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ ----------
const skins = {
  custom: [
    { name: "Ú¯Ù„ Ø¢Ù‚Ø§", price: 0, currency: "Ø³Ú©Ù‡", headColor: 0x000000, bodyColor: 0x0a5eff, legsColor: 0x000000, armsColor: 0x0a5eff, shoesColor: 0xffffff, details: "Ø¢ÛŒÚ©ÙˆÙ† Ø³Ø¨Ø² Ø¯Ø§ÛŒØ±Ù‡ Ø§ÛŒ Ø±ÙˆÛŒ Ù„Ø¨Ø§Ø³" },
    { name: "Ø®Ø§Ù†Ù… Ú¯Ù„", price: 0, currency: "Ø³Ú©Ù‡", headColor: 0x000000, bodyColor: 0xff69b4, legsColor: 0xffffff, armsColor: 0xff69b4, shoesColor: 0xff0000, details: "Ù…ÙˆÙ‡Ø§ÛŒ Ø³ÛŒØ§Ù‡ Ø¨Ù„Ù†Ø¯ØŒ Ø¹Ù„Ø§Ù…Øª Ú¯ÙˆÚ¯ÙˆÙ„ÛŒ Ø³ÙÛŒØ¯ Ø±ÙˆÛŒ Ù„Ø¨Ø§Ø³" }
  ],
  job: [
    { name: "Ù¾Ù„ÛŒØ³ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ Ùˆ Ø±Ø§Ù†Ù†Ø¯Ú¯ÛŒ", price: 800, currency: "Ø³Ú©Ù‡", headColor: 0x000000, bodyColor: 0xffffff, legsColor: 0x000000, armsColor: 0xffffff, shoesColor: 0x000000, details: "Ø¹ÛŒÙ†Ú© Ø¯ÙˆØ¯ÛŒØŒ Ú©Ù„Ø§Ù‡ Ù„Ø¨Ù‡ Ø¯Ø§Ø± Ø³ÙÛŒØ¯ØŒ Ø¢Ø±Ù… Ù†Ø§Ø±Ù†Ø¬ÛŒ Ù…Ø´Ú©ÛŒ Ø±ÙˆÛŒ Ø¨Ø§Ø²ÙˆÙ‡Ø§ØŒ Ù†ÙˆØ§Ø± Ø¢Ø¨ÛŒ Ø¨ØºÙ„ Ø´Ù„ÙˆØ§Ø±" },
    { name: "Ø¢Ø´Ù¾Ø²", price: 600, currency: "Ø³Ú©Ù‡", headColor: 0x000000, bodyColor: 0xffffff, legsColor: 0x000000, armsColor: 0xffffff, shoesColor: 0x000000, details: "Ø³ÛŒØ¨ÛŒÙ„ØŒ Ú©Ù„Ø§Ù‡ Ø¢Ø´Ù¾Ø² Ø³ÙÛŒØ¯ØŒ Ù¾ÛŒØ´Ø¨Ù†Ø¯ Ù…Ø´Ú©ÛŒ" },
    { name: "Ø¯Ú©ØªØ±", price: 650, currency: "Ø³Ú©Ù‡", headColor: 0x000000, bodyColor: 0xffffff, legsColor: 0x0000ff, armsColor: 0xffffff, shoesColor: 0xffffff, details: "Ø¹ÛŒÙ†Ú© Ø¯ÙˆØ± Ú¯Ø±Ø¯ØŒ ØªÛŒØ´Ø±Øª Ù…Ø´Ú©ÛŒ Ø²ÛŒØ±ØŒ Ú¯ÙˆØ´ÛŒ Ø¯Ú©ØªØ± Ø±ÙˆÛŒ Ú¯Ø±Ø¯Ù†" },
    { name: "Ø±Ø§Ù†Ù†Ø¯Ù‡ ØªØ§Ú©Ø³ÛŒ", price: 400, currency: "Ø³Ú©Ù‡", headColor: 0x000000, bodyColor: 0x808080, legsColor: 0x000000, armsColor: 0x808080, shoesColor: 0x000000, details: "Ù„Ø¨Ø§Ø³ Ø±Ø§Ù†Ù†Ø¯Ù‡ ØªØ§Ú©Ø³ÛŒ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯" },
    { name: "Ù†Ø§Ù†ÙˆØ§", price: 250, currency: "Ø³Ú©Ù‡", headColor: 0x000000, bodyColor: 0xffffff, legsColor: 0xffffff, armsColor: 0xffffff, shoesColor: 0xffffff, details: "Ù„Ø¨Ø§Ø³ Ùˆ Ú©Ù„Ø§Ù‡ Ø³ÙÛŒØ¯ Ú¯Ø´Ø§Ø¯ Ùˆ Ú†Ø±ÙˆÚ© Ø¯Ø§Ø±" },
    { name: "Ú¯Ø§Ø±Ø³ÙˆÙ†", price: 500, currency: "Ø³Ú©Ù‡", headColor: 0x000000, bodyColor: 0x000000, legsColor: 0x000000, armsColor: 0x000000, shoesColor: 0x000000, details: "Ú©Øª Ùˆ Ø´Ù„ÙˆØ§Ø± Ú¯Ø§Ø±Ø³ÙˆÙ†ØŒ Ù…Ùˆ Ø¯Ø§Ø±" }
  ],
  special: [
    { name: "Ú©ÙˆØ±ÙˆØ´ Ú©Ø¨ÛŒØ±", price: 2500, currency: "Ø³Ú©Ù‡", altPrice: 5, altCurrency: "Ø±ÙˆØ¨ÛŒ", headColor: 0x000000, bodyColor: 0x800080, legsColor: 0x800080, armsColor: 0x800080, shoesColor: 0x000000, details: "Ù…ÙˆÙ‡Ø§ÛŒ Ø¨Ø§ÙØªÙ‡ Ø³ÛŒØ§Ù‡ØŒ Ø±ÛŒØ´ØŒ ØªØ§Ø¬ hemhemØŒ Ø±Ø¯Ø§ Ø³Ù„Ø·Ù†ØªÛŒ Ø¨Ù†ÙØ´ Ø¨Ø§ Ù„Ø¨Ù‡ Ø·Ù„Ø§ÛŒÛŒ" },
    { name: "Ù‡ÛŒØªÙ„Ø±", price: 1000, currency: "Ø³Ú©Ù‡", altPrice: 2, altCurrency: "Ø±ÙˆØ¨ÛŒ", headColor: 0x000000, bodyColor: 0x8b4513, legsColor: 0x000000, armsColor: 0x8b4513, shoesColor: 0x000000, details: "Ù…ÙˆÙ‡Ø§ÛŒ Ø³ÛŒØ§Ù‡ØŒ Ø³Ø¨ÛŒÙ„ Ú©ÙˆÚ†Ú©ØŒ Ù„Ø¨Ø§Ø³ Ù†Ø¸Ø§Ù…ÛŒ Ù‚Ù‡ÙˆÙ‡ Ø§ÛŒ Ø¨Ø§ Ù†Ø´Ø§Ù†" }
  ]
};

// Ø«Ø¨Øª Ù†Ø§Ù… (ÙˆÙ‚ØªÛŒ Ú©Ø§Ø±Ø¨Ø± Ø§Ø³Ù…Ø´Ùˆ ÙˆØ§Ø±Ø¯ Ù…ÛŒÚ©Ù†Ù‡ØŒ Ù†Ø§Ù… Ù¾Ù„ÛŒØ± Ø¬Ø§Ø±ÛŒ Ø¨Ø±ÙˆØ² Ù…ÛŒâ€ŒØ´Ù‡)
// Ø§Ú¯Ø± Ù†Ø§Ù… Ø¨Ø§ ÛŒÚ©ÛŒ Ø§Ø² Ù¾Ù„ÛŒØ±Ù‡Ø§ ØªØ·Ø§Ø¨Ù‚ Ø¯Ø§Ø´ØªØŒ Ø§ÙˆÙ† Ù¾Ù„ÛŒØ± Ø¨Ù‡â€ŒØ¹Ù†ÙˆØ§Ù† current Ø§Ù†ØªØ®Ø§Ø¨ Ù…ÛŒâ€ŒØ´Ù‡
window.onload = () => {
  if (usernamePopup) usernamePopup.style.display = "flex";
  if (playerIdEl) {
    playerIdEl.textContent = players[currentPlayerIndex].id;
  }
  updateResourceUI();
  initClothesStore();
};
usernameSubmit.addEventListener("click", (e)=>{
  e.preventDefault();
  const name = usernameInput.value.trim();
  if (!name) { alert("Ù„Ø·ÙØ§ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯"); return; }
  // Ø¨Ø±ÙˆØ² Ø±Ø³Ø§Ù†ÛŒ Ù†Ø§Ù… Ø¯Ø± Ù…Ù†Ùˆ Ùˆ Ø¨Ø§Ø²ÛŒ
  if (playerNameMenu) playerNameMenu.textContent = name;
  if (playerNameGame) playerNameGame.textContent = name;

  // Ø¨Ø±Ø±Ø³ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ø¢ÛŒØ§ Ù†Ø§Ù… ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ø¨Ø§ ÛŒÚ©ÛŒ Ø§Ø² Ù¾Ù„ÛŒØ±Ù‡Ø§ÛŒ Ù„ÛŒØ³Øª Ù…Ø·Ø§Ø¨Ù‚Øª Ø¯Ø§Ø±Ù‡
  const found = findPlayerByName(name);
  if (found) {
    currentPlayerIndex = players.indexOf(found);
  } else {
    // Ø§Ú¯Ø± Ù†Ø§Ù… Ø¬Ø¯ÛŒØ¯ Ø§Ø³ØªØŒ Ù¾Ù„ÛŒØ± ÙØ¹Ù„ÛŒ Ø±Ø§ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
    players[currentPlayerIndex].name = name;
  }

  // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¢ÛŒØ¯ÛŒ Ù†Ù…Ø§ÛŒØ´ÛŒ Ø¨Ø±Ø§ÛŒ Ù…Ù†Ùˆ
  if (playerIdEl) playerIdEl.textContent = players[currentPlayerIndex].id;

  usernamePopup.style.display = "none";
  updateResourceUI();
});
usernameInput.addEventListener("keydown", (e)=>{ if (e.key === "Enter") usernameSubmit.click(); });
copyBtn && copyBtn.addEventListener("click", ()=>{ navigator.Ù„.writeText(playerIdEl.textContent); alert("Ø¢ÛŒØ¯ÛŒ Ú©Ù¾ÛŒ Ø´Ø¯ âœ…"); });

// Ù…Ù†Ùˆ -> Ø§Ù†ØªØ®Ø§Ø¨ -> Ù„ÙˆØ¯ÛŒÙ†Ú¯ -> Ø¨Ø§Ø²ÛŒ
startBtn.addEventListener("click", ()=>{ menuScreen.classList.remove("active"); modeScreen.classList.add("active"); });
enterCityBtn.addEventListener("click", ()=>{
  modeScreen.classList.remove("active");
  loadingScreen.classList.add("active");
  setTimeout(()=>{
    loadingScreen.classList.remove("active");
    gameScreen.classList.add("active");
    startGame();
    startStatsSystem();
  }, 1200);
});

// Ø¬Ø¯ÛŒØ¯: Ø¯Ú©Ù…Ù‡ Ø¨Ø±Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†Ùˆ
backToMenuBtn.addEventListener("click", () => {
  modeScreen.classList.remove("active");
  menuScreen.classList.add("active");
});

// Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI Ù…Ù†Ø§Ø¨Ø¹
function updateResourceUI(){
  if (healthBarEl) healthBarEl.style.width = `${Math.max(0,Math.min(100,HEALTH))}%`;
  if (energyBarEl) energyBarEl.style.width = `${Math.max(0,Math.min(100,(ENERGY/500*100))) }%`;
  if (hungerBarEl) hungerBarEl.style.width = `${Math.max(0,Math.min(100,(HUNGER/50*100))) }%`;
  if (healthTextEl) healthTextEl.textContent = `${Math.round(HEALTH)} Ø§Ø² 100`;
  if (energyTextEl) energyTextEl.textContent = `${Math.round(ENERGY)} Ø§Ø² 500`;
  if (hungerTextEl) hungerTextEl.textContent = `${Math.round(HUNGER)} Ø§Ø² 50`;
  if (coinsGame) coinsGame.textContent = players[currentPlayerIndex].coins;
  if (rubiesGame) rubiesGame.textContent = players[currentPlayerIndex].rubies;
  if (coinsEl) coinsEl.textContent = players[currentPlayerIndex].coins;
  if (rubiesEl) rubiesEl.textContent = players[currentPlayerIndex].rubies;
}

// ---------- Ø§ÙˆÙ„ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù¾Ù†Ù„ Ù„Ø¨Ø§Ø³â€ŒÙ‡Ø§ ----------
function initClothesStore(){
  const tabBtns = clothesStore.querySelectorAll('.tab-btn');
  const tabContents = clothesStore.querySelectorAll('.tab-content');

  tabBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      tabBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      tabContents.forEach(c => c.style.display = 'none');
      document.getElementById(btn.dataset.tab + '-tab').style.display = 'block';
    });
  });

  // Ù¾Ø± Ú©Ø±Ø¯Ù† gridÙ‡Ø§
  ['custom', 'job', 'special'].forEach(category => {
    const grid = document.getElementById(category + '-tab').querySelector('.skins-grid');
    skins[category].forEach((skin, index) => {
      const item = document.createElement('div');
      item.classList.add('skin-item');
      let priceText = `Ù‚ÛŒÙ…Øª: ${skin.price} ${skin.currency}`;
      if (skin.altPrice) priceText += ` ÛŒØ§ ${skin.altPrice} ${skin.altCurrency}`;
      item.innerHTML = `
        <h4>${skin.name}</h4>
        <p>${priceText}</p>
        <button class="skin-buy-btn" data-category="${category}" data-index="${index}">${skin.price === 0 ? 'Ø§Ù†ØªØ®Ø§Ø¨' : 'Ø®Ø±ÛŒØ¯'}</button>
      `;
      grid.appendChild(item);
    });
  });

  // event delegation Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø®Ø±ÛŒØ¯/Ø§Ù†ØªØ®Ø§Ø¨
  clothesStore.addEventListener('click', (e) => {
    if (e.target.classList.contains('skin-buy-btn')) {
      const category = e.target.dataset.category;
      const index = parseInt(e.target.dataset.index);
      const skin = skins[category][index];
      const player = players[currentPlayerIndex];
      let canBuy = false;
      if (skin.price === 0) {
        canBuy = true;
      } else if (skin.currency === "Ø³Ú©Ù‡" && player.coins >= skin.price) {
        player.coins -= skin.price;
        canBuy = true;
      } else if (skin.altCurrency && skin.altCurrency === "Ø±ÙˆØ¨ÛŒ" && player.rubies >= skin.altPrice) {
        player.rubies -= skin.altPrice;
        canBuy = true;
      }
      if (canBuy) {
        player.currentSkin = skin.name;
        updateResourceUI();
        alert(`${skin.name} ${skin.price === 0 ? 'Ø§Ù†ØªØ®Ø§Ø¨' : 'Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ'} Ø´Ø¯! âœ…`);
      } else {
        alert("Ù…Ù†Ø§Ø¨Ø¹ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª! ğŸ˜”");
      }
    }
  });

  // Ø¨Ø§Ø² Ùˆ Ø¨Ø³Øª Ù¾Ù†Ù„ (Ø­Ø§Ù„Ø§ Ø¯Ø± Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ù‡)
  clothesBtn.addEventListener('click', () => { clothesStore.style.display = 'flex'; });
  closeClothes.addEventListener('click', () => { clothesStore.style.display = 'none'; });
}

// ---------- START GAME (Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù…Ù¾ Ø³Ø§Ø¯Ù‡) ----------
function startGame(){
  const canvas = document.getElementById("game-canvas");
  const scene = new THREE.Scene();

  // Ø¢Ø³Ù…Ø§Ù† Ø³Ø§Ø¯Ù‡
  scene.background = new THREE.Color(0x79b3e6);

  // renderer + camera
  const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 3000);
  const renderer = new THREE.WebGLRenderer({ canvas, antialias:true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.setPixelRatio(window.devicePixelRatio || 1);
  renderer.shadowMap.enabled = true;
  renderer.shadowMap.type = THREE.PCFSoftShadowMap;

  // Ù†ÙˆØ±
  const ambient = new THREE.AmbientLight(0xffffff, 0.7);
  scene.add(ambient);
  const sun = new THREE.DirectionalLight(0xffffff, 0.8);
  sun.position.set(100,200,100);
  sun.castShadow = true;
  sun.shadow.mapSize.width = sun.shadow.mapSize.height = 1024;
  scene.add(sun);

  // ---------- Ø²Ù…ÛŒÙ† Ø³Ø¨Ø² Ø³Ø§Ø¯Ù‡ ----------
  const MAP_SIZE = 600;
  const groundGeo = new THREE.PlaneGeometry(MAP_SIZE, MAP_SIZE);
  const groundMat = new THREE.MeshStandardMaterial({ color: 0x1f6f2f });
  const ground = new THREE.Mesh(groundGeo, groundMat);
  ground.rotation.x = -Math.PI/2;
  ground.receiveShadow = true;
  scene.add(ground);

  // ---------------- Ú©Ø§Ø±Ø§Ú©ØªØ± Ù…Ø§ÛŒÙ†Ú©Ø±Ø§ÙØªÛŒ ----------------
  const character = new THREE.Group();

  const LEG_H = 1.0, LEG_W = 0.32, LEG_D = 0.32;
  const BODY_H = 1.5, BODY_W = 1.0, BODY_D = 0.5;
  const HEAD_H = 0.8, HEAD_W = 0.8, HEAD_D = 0.8;

  // Ø§Ø¹Ù…Ø§Ù„ Ø§Ø³Ú©ÛŒÙ† ÙØ¹Ù„ÛŒ
  const currentSkinName = players[currentPlayerIndex].currentSkin;
  let skin = Object.values(skins).flat().find(s => s.name === currentSkinName) || skins.custom[0]; // Ø¯ÛŒÙØ§Ù„Øª Ú¯Ù„ Ø¢Ù‚Ø§

  const bodyMat = new THREE.MeshStandardMaterial({color: skin.bodyColor});
  const limbMat = new THREE.MeshStandardMaterial({color: skin.legsColor}); // Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ù‡Ø§ Ùˆ Ø¯Ø³Øªâ€ŒÙ‡Ø§
  const headMat = new THREE.MeshStandardMaterial({color: skin.headColor});
  const armsMat = new THREE.MeshStandardMaterial({color: skin.armsColor || skin.bodyColor});
  const shoesMat = new THREE.MeshStandardMaterial({color: skin.shoesColor || 0x000000}); // Ø§Ú¯Ø± Ø¬Ø¯Ø§ Ø¨Ø§Ø´Ù‡

  const leftLeg = new THREE.Mesh(new THREE.BoxGeometry(LEG_W, LEG_H, LEG_D), limbMat);
  leftLeg.position.set(-0.25, LEG_H/2, 0);
  leftLeg.castShadow = true;
  const rightLeg = new THREE.Mesh(new THREE.BoxGeometry(LEG_W, LEG_H, LEG_D), limbMat);
  rightLeg.position.set(0.25, LEG_H/2, 0);
  rightLeg.castShadow = true;

  const bodyMesh = new THREE.Mesh(new THREE.BoxGeometry(BODY_W, BODY_H, BODY_D), bodyMat);
  bodyMesh.position.set(0, LEG_H + BODY_H/2, 0);
  bodyMesh.castShadow = true;

  const headMesh = new THREE.Mesh(new THREE.BoxGeometry(HEAD_W, HEAD_H, HEAD_D), headMat);
  headMesh.position.set(0, LEG_H + BODY_H + HEAD_H/2, 0);
  headMesh.castShadow = true;

  const leftArm = new THREE.Mesh(new THREE.BoxGeometry(0.28,1,0.28), armsMat);
  const rightArm = new THREE.Mesh(new THREE.BoxGeometry(0.28,1,0.28), armsMat);
  leftArm.position.set(-(BODY_W/2 + 0.14), LEG_H + BODY_H - 0.45, 0);
  rightArm.position.set((BODY_W/2 + 0.14), LEG_H + BODY_H - 0.45, 0);
  leftArm.castShadow = rightArm.castShadow = true;

  character.add(leftLeg, rightLeg, bodyMesh, headMesh, leftArm, rightArm);
  // Ù‚Ø±Ø§Ø±Ú¯ÛŒØ±ÛŒ: Ù…Ø±Ú©Ø² Ø²Ù…ÛŒÙ†
  character.position.set(0, 0, 0);
  scene.add(character);

  // ÙÛŒØ²ÛŒÚ© Ø­Ø±Ú©Øª
  let velY = 0;
  const GRAV = -18.0;
  let onGround = true;

  const keys = {};
  window.addEventListener("keydown", (e)=>{ keys[e.code] = true; });
  window.addEventListener("keyup", (e)=>{ keys[e.code] = false; });

  // Ù…ÙˆØ³ Ù„Ø§Ú©
  let pointerLocked = false;
  canvas.addEventListener("click", ()=> canvas.requestPointerLock());
  document.addEventListener("pointerlockchange", ()=> { pointerLocked = (document.pointerLockElement === canvas); });

  let yaw = 0, pitch = 0;
  const MOUSE_SENS = 0.0028;
  document.addEventListener("mousemove", (e)=>{
    if (!pointerLocked) return;
    yaw -= e.movementX * MOUSE_SENS;
    pitch -= e.movementY * MOUSE_SENS;
    pitch = Math.max(-Math.PI/3, Math.min(Math.PI/3, pitch));
  });

  let vMode = false;
  window.addEventListener("keydown", (e)=>{ if (e.code === "KeyV") vMode = !vMode; });

  window.addEventListener("keydown", (e)=>{
    if (e.code.startsWith("Digit")) {
      const idx = parseInt(e.code.slice(5)) - 1;
      if (!Number.isNaN(idx) && idx >= 0 && idx < itemEls.length) highlightItem(idx);
    }
  });
  function highlightItem(idx){
    itemEls.forEach((el,i)=> el.classList.toggle("active", i===idx));
    const el = itemEls[idx];
    if (!el) return;
    el.style.transition = "transform 200ms ease, box-shadow 200ms ease";
    el.style.transform = "scale(1.2)";
    el.style.boxShadow = "0 0 14px rgba(0,160,255,0.9)";
    setTimeout(()=>{ el.style.transform = ""; el.style.boxShadow = ""; }, 220);
  }

  function localForward(y){ return new THREE.Vector3(0,0,-1).applyAxisAngle(new THREE.Vector3(0,1,0), y); }
  function localRight(y){ return new THREE.Vector3(1,0,0).applyAxisAngle(new THREE.Vector3(0,1,0), y); }

  let walkCycle = 0;
  const WALK_SPEED = 2.2, RUN_SPEED = 6.0, JUMP_V = 9.0;
  const ENERGY_MAX = 500, ENERGY_MIN_RUN = 50, ENERGY_CONSUME_PER_SEC = 40, ENERGY_RECOVER_PER_SEC = 12;
  let energyRecoverAccumulator = 0;
  let lastHungerTick = performance.now();
  let lastFrame = performance.now();
  let fallen = false;

  function animate(){
    const now = performance.now();
    const dt = Math.min(0.05, (now - lastFrame)/1000);
    lastFrame = now;

    if (!fallen) {
      const forward = localForward(yaw);
      const right = localRight(yaw);

      const moving = keys["KeyW"] || keys["KeyA"] || keys["KeyS"] || keys["KeyD"];

      const mv = new THREE.Vector3(0,0,0);
      if (keys["KeyW"]) mv.add(forward);
      if (keys["KeyS"]) mv.add(forward.clone().negate());
      if (keys["KeyA"]) mv.add(right.clone().negate());
      if (keys["KeyD"]) mv.add(right);

      if (mv.lengthSq() > 0.0001) mv.normalize();

      const wantsRun = !!keys["ShiftLeft"] || !!keys["ShiftRight"];
      let isRunning = wantsRun && (ENERGY >= ENERGY_MIN_RUN) && moving;
      if (ENERGY < ENERGY_MIN_RUN) isRunning = false;

      const speed = (isRunning ? RUN_SPEED : WALK_SPEED) * dt;
      if (mv.lengthSq() > 0.00001) character.position.add(mv.multiplyScalar(speed));

      if (isRunning) {
        const dec = ENERGY_CONSUME_PER_SEC * dt;
        ENERGY = Math.max(0, ENERGY - dec);
        if (ENERGY < ENERGY_MIN_RUN) isRunning = false;
      } else {
        const inc = ENERGY_RECOVER_PER_SEC * dt;
        const prevE = ENERGY;
        ENERGY = Math.min(ENERGY_MAX, ENERGY + inc);
        const recovered = ENERGY - prevE;
        if (recovered > 0) {
          energyRecoverAccumulator += recovered;
          if (energyRecoverAccumulator >= 10) {
            const times = Math.floor(energyRecoverAccumulator/10);
            HUNGER = Math.max(0, HUNGER - times);
            energyRecoverAccumulator -= times*10;
          }
        }
      }

      // Ù¾Ø±Ø´
      if (keys["Space"] && onGround) { velY = JUMP_V; onGround = false; }

      // Ú¯Ø±Ø§Ù†Ø´
      velY += GRAV * dt;
      character.position.y += velY * dt;
      if (character.position.y <= 0) { character.position.y = 0; velY = 0; onGround = true; }

      // Ú†Ø±Ø®Ø´ Ùˆ Ø³Ø±
      character.rotation.y = yaw;
      headMesh.rotation.x += (pitch - headMesh.rotation.x)*0.18;

      // Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ø§Ù†Ø¯Ø§Ù…â€ŒÙ‡Ø§
      if (mv.lengthSq() > 0.00001) {
        walkCycle += (isRunning ? 14 : 6) * dt;
        const amp = isRunning ? 1.0 : 0.5;
        const armA = Math.sin(walkCycle) * amp;
        const legA = Math.sin(walkCycle) * amp;
        leftArm.rotation.x = armA;
        rightArm.rotation.x = -armA;
        leftLeg.rotation.x = -legA;
        rightLeg.rotation.x = legA;
        bodyMesh.rotation.x = isRunning ? Math.sin(walkCycle)*0.03 : bodyMesh.rotation.x*0.9;
      } else {
        leftArm.rotation.x *= 0.85;
        rightArm.rotation.x *= 0.85;
        leftLeg.rotation.x *= 0.85;
        rightLeg.rotation.x *= 0.85;
        bodyMesh.rotation.x *= 0.85;
      }
    }

    // Ú¯Ø±Ø³Ù†Ú¯ÛŒ tick
    if (performance.now() - lastHungerTick >= 10000) {
      lastHungerTick = performance.now();
      HUNGER = Math.max(0, HUNGER - 2);
      if (HUNGER === 0) HEALTH = Math.max(0, HEALTH - 5);
    }

    // clamp Ùˆ update ui
    HEALTH = Math.max(0, Math.min(100, HEALTH));
    ENERGY = Math.max(0, Math.min(ENERGY_MAX, ENERGY));
    HUNGER = Math.max(0, Math.min(50, HUNGER));
    updateResourceUI();

    // Ø³Ù‚ÙˆØ· ÙˆÙ‚ØªÛŒ health 0
    if (HEALTH <= 0 && !fallen) {
      fallen = true;
      const start = performance.now();
      const dur = 600;
      const fromZ = character.rotation.z;
      function fallAnim(now) {
        const p = Math.min(1, (now - start)/dur);
        character.rotation.z = fromZ + p*(Math.PI/2);
        character.position.y = Math.max(0, character.position.y - p*0.02);
        if (p < 1) requestAnimationFrame(fallAnim);
      }
      requestAnimationFrame(fallAnim);
    }

    // Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø³ÙˆÙ… Ø´Ø®Øµ
    const camOffset = vMode ? new THREE.Vector3(0,1.8,-4.0) : new THREE.Vector3(0,3.2,6.0);
    const camRot = camOffset.clone().applyAxisAngle(new THREE.Vector3(0,1,0), yaw);
    camera.position.copy(character.position.clone().add(camRot));
    camera.lookAt(character.position.clone().add(new THREE.Vector3(0, BODY_H*0.5 + LEG_H*0, 0)));

    renderer.render(scene, camera);
    requestAnimationFrame(animate);
  }

  // Ø¢ØºØ§Ø² Ø­Ù„Ù‚Ù‡
  lastFrame = performance.now();
  animate();

  // resize
  window.addEventListener("resize", ()=>{
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });

  // Ø¬Ø¯ÛŒØ¯: Ù¾Ù†Ù„ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¯Ø± Ø¨Ø§Ø²ÛŒ
  gameSettings.addEventListener("click", () => {
    gameSettingsPopup.style.display = "flex";
  });
  closeSettings.addEventListener("click", () => {
    gameSettingsPopup.style.display = "none";
  });
  exitGame.addEventListener("click", () => {
    gameScreen.classList.remove("active");
    gameSettingsPopup.style.display = "none";
    menuScreen.classList.add("active");
  });

  // ----- Ù¾Ù†Ù„ Ø¨Ø§Ø²Ø±Ø³ÛŒ: UI Ùˆ Ù…Ù†Ø·Ù‚ (Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡) -----
  // Ø¯Ú©Ù…Ù‡Ù” Ù¾Ù†Ù„ Ø¨Ø§Ø²Ø±Ø³ÛŒ Ø±Ø§ Ú©Ù†Ø§Ø± Ø¢ÛŒÚ©ÙˆÙ† Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
  function createInspectorButton(){
    const mobileIcon = document.getElementById("mobile-icon");
    if (!mobileIcon) return;

    // wrapper Ø¨Ø±Ø§ÛŒ Ú©Ù†ØªØ±Ù„ Ù…ÙˆÙ‚Ø¹ÛŒØª
    const wrapper = document.createElement("div");
    wrapper.style.position = "absolute";
    wrapper.style.left = getComputedStyle(mobileIcon).left || "20px";
    // Ù‚Ø±Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø²ÛŒØ± Ø¢ÛŒÚ©ÙˆÙ† Ù…ÙˆØ¨Ø§ÛŒÙ„
    wrapper.style.bottom = "80px";
    wrapper.style.zIndex = 999;
    wrapper.style.display = "flex";
    wrapper.style.justifyContent = "center";
    wrapper.style.alignItems = "center";
    wrapper.style.width = "140px";
    wrapper.style.pointerEvents = "auto";

    const btn = document.createElement("button");
    btn.textContent = "Ù¾Ù†Ù„ Ø¨Ø§Ø²Ø±Ø³ÛŒ";
    btn.style.padding = "10px 12px";
    btn.style.borderRadius = "10px";
    btn.style.border = "none";
    btn.style.cursor = "pointer";
    btn.style.background = "rgba(255,255,255,0.12)";
    btn.style.color = "white";
    btn.style.fontSize = "14px";
    btn.style.boxShadow = "0 2px 8px rgba(0,0,0,0.3)";
    btn.style.backdropFilter = "blur(4px)";
    btn.style.transition = "transform .12s ease";
    btn.addEventListener("mouseenter", ()=> btn.style.transform = "translateY(-3px)");
    btn.addEventListener("mouseleave", ()=> btn.style.transform = "");

    wrapper.appendChild(btn);
    // Ø§Ù„Ø­Ø§Ù‚ Ø¯Ø± Ø¨Ø¯Ù†Ù‡Ù” Ø¨Ø§Ø²ÛŒ ØªØ§ Ù‡Ù…Ø±Ø§Ù‡ canvas Ø¨Ø§Ø´Ø¯
    document.body.appendChild(wrapper);

    // Ú©Ù„ÛŒÚ© => Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ø¨Ø§Ø²Ø±Ø³ Ùˆ Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù¾Ù†Ù„
    btn.addEventListener("click", ()=> openInspectorAuth());
  }

  // Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ø¨Ø§Ø²Ø±Ø³ (ÙˆØ±ÙˆØ¯ Ø¢ÛŒØ¯ÛŒ)
  function openInspectorAuth(){
    // Ù„Ø§ÛŒÙ‡Ù” Ù†ÛŒÙ…Ù‡â€ŒØ´ÙØ§Ù
    const overlay = document.createElement("div");
    overlay.style.position = "fixed";
    overlay.style.left = 0; overlay.style.top = 0; overlay.style.width = "100%"; overlay.style.height = "100%";
    overlay.style.background = "rgba(0,0,0,0.6)";
    overlay.style.display = "flex";
    overlay.style.justifyContent = "center";
    overlay.style.alignItems = "center";
    overlay.style.zIndex = 1200;

    const box = document.createElement("div");
    box.style.width = "360px";
    box.style.maxWidth = "92%";
    box.style.background = "#222";
    box.style.borderRadius = "12px";
    box.style.padding = "18px";
    box.style.textAlign = "center";
    box.style.color = "white";

    const title = document.createElement("h3");
    title.textContent = "ÙˆØ±ÙˆØ¯ Ø¢ÛŒØ¯ÛŒ Ø¨Ø§Ø²Ø±Ø³";
    title.style.marginTop = "0";
    title.style.marginBottom = "10px";
    box.appendChild(title);

    const info = document.createElement("p");
    info.textContent = "Ù„Ø·ÙØ§ Ø¢ÛŒØ¯ÛŒ Ø¨Ø§Ø²Ø±Ø³ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ ØªØ§ Ù¾Ù†Ù„ Ø¨Ø§Ø²Ø±Ø³ÛŒ ÙØ¹Ø§Ù„ Ø´ÙˆØ¯.";
    info.style.fontSize = "13px";
    info.style.color = "#ddd";
    box.appendChild(info);

    const input = document.createElement("input");
    input.type = "text";
    input.placeholder = "Ù…Ø«Ø§Ù„: INSPECTOR001";
    input.style.width = "100%";
    input.style.padding = "10px";
    input.style.marginTop = "10px";
    input.style.borderRadius = "8px";
    input.style.border = "none";
    input.style.fontSize = "14px";
    box.appendChild(input);

    const btns = document.createElement("div");
    btns.style.display = "flex";
    btns.style.gap = "10px";
    btns.style.marginTop = "12px";
    btns.style.justifyContent = "center";

    const submit = document.createElement("button");
    submit.textContent = "ÙˆØ±ÙˆØ¯";
    submit.style.padding = "8px 12px";
    submit.style.borderRadius = "8px";
    submit.style.border = "none";
    submit.style.cursor = "pointer";
    submit.style.background = "#00bcd4";
    submit.style.color = "#000";

    const cancel = document.createElement("button");
    cancel.textContent = "Ø§Ù†ØµØ±Ø§Ù";
    cancel.style.padding = "8px 12px";
    cancel.style.borderRadius = "8px";
    cancel.style.border = "none";
    cancel.style.cursor = "pointer";
    cancel.style.background = "#555";
    cancel.style.color = "#fff";

    btns.appendChild(submit);
    btns.appendChild(cancel);
    box.appendChild(btns);
    overlay.appendChild(box);
    document.body.appendChild(overlay);

    // Ø­ÙˆØ§Ø¯Ø«
    cancel.addEventListener("click", ()=> { document.body.removeChild(overlay); });
    submit.addEventListener("click", ()=> {
      const val = input.value.trim();
      if (!val) { alert("Ø¢ÛŒØ¯ÛŒ ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡"); return; }
      if (!inspectorIDs.includes(val)) { alert("Ø¢ÛŒØ¯ÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø± ÛŒØ§ Ø¯Ø³ØªØ±Ø³ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯"); return; }
      // Ù…ÙˆÙÙ‚ â€” Ø¨Ø³ØªÙ† Ø§ÛŒÙ† Ù¾Ù†Ø¬Ø±Ù‡ Ùˆ Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù¾Ù†Ù„ Ø¨Ø§Ø²Ø±Ø³ÛŒ Ø§ØµÙ„ÛŒ
      document.body.removeChild(overlay);
      openInspectorPanel(val);
    });

    input.addEventListener("keydown", (e)=>{ if (e.key === "Enter") submit.click(); });
  }

  // Ù¾Ù†Ù„ Ø¨Ø§Ø²Ø±Ø³ÛŒ Ø§ØµÙ„ÛŒ (Ø¨Ø¹Ø¯ Ø§Ø² Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª)
  function openInspectorPanel(inspectorId){
    // Ù„Ø§ÛŒÙ‡Ù” Ù†ÛŒÙ…Ù‡â€ŒØ´ÙØ§Ù
    const overlay = document.createElement("div");
    overlay.style.position = "fixed";
    overlay.style.left = 0; overlay.style.top = 0; overlay.style.width = "100%"; overlay.style.height = "100%";
    overlay.style.background = "rgba(0,0,0,0.5)";
    overlay.style.display = "flex";
    overlay.style.justifyContent = "center";
    overlay.style.alignItems = "center";
    overlay.style.zIndex = 1200;

    const box = document.createElement("div");
    box.style.width = "420px";
    box.style.maxWidth = "96%";
    box.style.background = "#111";
    box.style.borderRadius = "12px";
    box.style.padding = "16px";
    box.style.color = "white";
    box.style.boxShadow = "0 8px 30px rgba(0,0,0,0.6)";

    // Ø¹Ù†ÙˆØ§Ù†
    const title = document.createElement("h3");
    title.textContent = "Ù¾Ù†Ù„ Ø¨Ø§Ø²Ø±Ø³ÛŒ";
    title.style.margin = "0 0 8px 0";
    box.appendChild(title);

    const subtitle = document.createElement("p");
    subtitle.textContent = "Ù„Ø·ÙØ§ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ù¾Ù„ÛŒØ± Ø±Ø§ Ø§Ø² Ù„ÛŒØ³Øª Ù¾Ù„ÛŒØ±Ù‡Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯";
    subtitle.style.margin = "0 0 12px 0";
    subtitle.style.color = "#ddd";
    box.appendChild(subtitle);

    // dropdown Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†
    const select = document.createElement("select");
    select.style.width = "100%";
    select.style.padding = "10px";
    select.style.borderRadius = "8px";
    select.style.border = "none";
    select.style.fontSize = "14px";
    players.forEach((p, idx) => {
      const o = document.createElement("option");
      o.value = p.id;
      o.textContent = `${p.name} (${p.id})`;
      select.appendChild(o);
    });
    box.appendChild(select);

    // Ø¬Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù…Ø´Ø®ØµØ§Øª
    const infoBox = document.createElement("div");
    infoBox.style.marginTop = "12px";
    infoBox.style.background = "#0f0f0f";
    infoBox.style.padding = "12px";
    infoBox.style.borderRadius = "8px";
    infoBox.style.textAlign = "left";
    infoBox.style.color = "#fff";
    infoBox.innerHTML = `<div style="color:#aaa">Ù…Ø´Ø®ØµØ§Øª Ù¾Ù„ÛŒØ± Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</div>`;
    box.appendChild(infoBox);

    // Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª
    const ops = document.createElement("div");
    ops.style.display = "grid";
    ops.style.gridTemplateColumns = "1fr 1fr";
    ops.style.gap = "10px";
    ops.style.marginTop = "12px";

    const btnBlock = document.createElement("button");
    btnBlock.textContent = "Ù…Ø³Ø¯ÙˆØ¯ Ø³Ø§Ø²ÛŒ";
    styleOpButton(btnBlock);

    const btnRecord = document.createElement("button");
    btnRecord.textContent = "Ø³Ø§Ø¨Ù‚Ù‡ Ú©ÛŒÙØ±ÛŒ";
    styleOpButton(btnRecord);

    const btnWarn = document.createElement("button");
    btnWarn.textContent = "Ø§Ø±Ø³Ø§Ù„ Ø§Ø®Ø·Ø§Ø±";
    styleOpButton(btnWarn);

    const btnImpound = document.createElement("button");
    btnImpound.textContent = "ØªÙˆÙ‚ÛŒÙ Ø®ÙˆØ¯Ø±Ùˆ";
    styleOpButton(btnImpound);

    ops.appendChild(btnBlock);
    ops.appendChild(btnRecord);
    ops.appendChild(btnWarn);
    ops.appendChild(btnImpound);

    box.appendChild(ops);

    // Ø¯Ú©Ù…Ù‡Ù” Ø¨Ø³ØªÙ†
    const closeRow = document.createElement("div");
    closeRow.style.display = "flex";
    closeRow.style.justifyContent = "flex-end";
    closeRow.style.marginTop = "10px";
    const closeBtn = document.createElement("button");
    closeBtn.textContent = "Ø¨Ø³ØªÙ†";
    closeBtn.style.padding = "8px 12px";
    closeBtn.style.border = "none";
    closeBtn.style.borderRadius = "8px";
    closeBtn.style.cursor = "pointer";
    closeBtn.style.background = "#555";
    closeBtn.style.color = "#fff";
    closeRow.appendChild(closeBtn);
    box.appendChild(closeRow);

    overlay.appendChild(box);
    document.body.appendChild(overlay);

    // Ù†Ù…Ø§ÛŒØ´ Ù…Ø´Ø®ØµØ§Øª Ù¾Ù„ÛŒØ± Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
    function renderSelectedPlayer(pid){
      const p = findPlayerById(pid);
      if (!p) {
        infoBox.innerHTML = `<div style="color:#f66">Ù¾Ù„ÛŒØ± ÛŒØ§ÙØª Ù†Ø´Ø¯</div>`;
        return;
      }
      const rows = [];
      rows.push(`<div><b>Ù†Ø§Ù…:</b> ${escapeHtml(p.name)}</div>`);
      rows.push(`<div><b>Ø¢ÛŒØ¯ÛŒ:</b> ${escapeHtml(p.id)}</div>`);
      rows.push(`<div><b>Ø³Ú©Ù‡:</b> ${p.coins}</div>`);
      rows.push(`<div><b>Ø±ÙˆØ¨ÛŒ:</b> ${p.rubies}</div>`);
      rows.push(`<div><b>Ù…Ø³Ø¯ÙˆØ¯ Ø´Ø¯Ù‡:</b> ${p.blocked ? "Ø¨Ù„Ù‡" : "Ø®ÛŒØ±"}</div>`);
      rows.push(`<div><b>ØªØ¹Ø¯Ø§Ø¯ Ø§Ø®Ø·Ø§Ø±Ù‡Ø§:</b> ${p.warnings}</div>`);
      rows.push(`<div><b>Ø®ÙˆØ¯Ø±Ùˆ ØªÙˆÙ‚ÛŒÙ Ø´Ø¯Ù‡:</b> ${p.carImpounded ? "Ø¨Ù„Ù‡" : "Ø®ÛŒØ±"}</div>`);
      if (p.criminalRecords.length) {
        rows.push(`<div style="margin-top:6px"><b>Ø³ÙˆØ§Ø¨Ù‚ Ú©ÛŒÙØ±ÛŒ:</b></div>`);
        p.criminalRecords.forEach((r, i) => rows.push(`<div style="font-size:12px;color:#ddd">- ${escapeHtml(r)}</div>`));
      }
      infoBox.innerHTML = rows.join("");
    }

    // Ù¾ÛŒØ´â€ŒÙØ±Ø¶: Ø§ÙˆÙ„ÛŒÙ† Ù¾Ù„ÛŒØ±
    renderSelectedPlayer(select.value);

    // Ø±ÙˆÛŒØ¯Ø§Ø¯ ØªØºÛŒÛŒØ± Ø§Ù†ØªØ®Ø§Ø¨
    select.addEventListener("change", ()=> renderSelectedPlayer(select.value));

    // Ø¹Ù…Ù„ÛŒØ§Øª Ø±ÙˆÛŒ Ù¾Ù„ÛŒØ±Ù‡Ø§ (Ù‡Ù…Ù‡ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ)
    btnBlock.addEventListener("click", ()=>{
      const p = findPlayerById(select.value);
      if (!p) return alert("Ù¾Ù„ÛŒØ± Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯");
      p.blocked = !p.blocked;
      renderSelectedPlayer(p.id);
      alert(`ÙˆØ¶Ø¹ÛŒØª Ù…Ø³Ø¯ÙˆØ¯Ø³Ø§Ø²ÛŒ ${p.name} Ø§Ú©Ù†ÙˆÙ†: ${p.blocked ? "Ù…Ø³Ø¯ÙˆØ¯" : "ØºÛŒØ±ÙØ¹Ø§Ù„"}`);
      console.log(`[Inspector ${inspectorId}] Block toggled for ${p.name} (${p.id}). Now blocked=${p.blocked}`);
    });

    btnRecord.addEventListener("click", ()=>{
      const p = findPlayerById(select.value);
      if (!p) return alert("Ù¾Ù„ÛŒØ± Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯");
      const reason = prompt("ØªÙˆØ¶ÛŒØ­ Ø³Ø§Ø¨Ù‚Ù‡ Ú©ÛŒÙØ±ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ (Ù…Ø«Ù„Ø§Ù‹: Ø³Ø±Ù‚Øª Ø®ÙˆØ¯Ø±Ùˆ):");
      if (!reason) return;
      p.criminalRecords.push(reason);
      renderSelectedPlayer(p.id);
      alert("Ø³Ø§Ø¨Ù‚Ù‡ Ú©ÛŒÙØ±ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯");
      console.log(`[Inspector ${inspectorId}] Added criminal record to ${p.name}: ${reason}`);
    });

    btnWarn.addEventListener("click", ()=>{
      const p = findPlayerById(select.value);
      if (!p) return alert("Ù¾Ù„ÛŒØ± Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯");
      p.warnings = (p.warnings || 0) + 1;
      renderSelectedPlayer(p.id);
      alert(`Ø§Ø±Ø³Ø§Ù„ Ø§Ø®Ø·Ø§Ø± Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯. ØªØ¹Ø¯Ø§Ø¯ Ø§Ø®Ø·Ø§Ø±Ù‡Ø§: ${p.warnings}`);
      console.log(`[Inspector ${inspectorId}] Warning sent to ${p.name}. Total warnings=${p.warnings}`);
    });

    btnImpound.addEventListener("click", ()=>{
      const p = findPlayerById(select.value);
      if (!p) return alert("Ù¾Ù„ÛŒØ± Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯");
      p.carImpounded = !p.carImpounded;
      renderSelectedPlayer(p.id);
      alert(`ÙˆØ¶Ø¹ÛŒØª ØªÙˆÙ‚ÛŒÙ Ø®ÙˆØ¯Ø±Ùˆ ${p.name}: ${p.carImpounded ? "ØªÙˆÙ‚ÛŒÙ Ø´Ø¯" : "Ø¢Ø²Ø§Ø¯ Ø´Ø¯"}`);
      console.log(`[Inspector ${inspectorId}] Toggled impound for ${p.name}. Now impounded=${p.carImpounded}`);
    });

    // Ø¨Ø³ØªÙ† Ù¾Ù†Ù„
    closeBtn.addEventListener("click", ()=> { document.body.removeChild(overlay); });
  }

  // helper Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªØ§ÛŒÙ„ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª
  function styleOpButton(btn){
    btn.style.padding = "10px";
    btn.style.borderRadius = "8px";
    btn.style.border = "none";
    btn.style.cursor = "pointer";
    btn.style.background = "#222";
    btn.style.color = "#fff";
    btn.style.boxShadow = "inset 0 -2px 0 rgba(0,0,0,0.4)";
    btn.addEventListener("mouseenter", ()=> btn.style.transform = "translateY(-2px)");
    btn.addEventListener("mouseleave", ()=> btn.style.transform = "");
  }

  // escapeHtml Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² XSS Ø³Ø§Ø¯Ù‡ (Ù‡Ø±Ú†Ù†Ø¯ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù…Ø­Ù„ÛŒâ€ŒØ§Ù†Ø¯)
  function escapeHtml(s) {
    return String(s).replace(/[&<>"'`=\/]/g, function (c) {
      return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;','/':'&#x2F;','`':'&#x60;','=':'&#x3D;'})[c];
    });
  }

  // Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ú©Ù…Ù‡Ù” Ù¾Ù†Ù„ Ø¨Ø§Ø²Ø±Ø³ÛŒ
  createInspectorButton();

} // end startGame

// ---------- Ø³ÛŒØ³ØªÙ… Ø§Ø³ØªØ§Øªâ€ŒÙ‡Ø§ (Ù‡Ø± 10 Ø«Ø§Ù†ÛŒÙ‡ tick) ----------
let statsIntervalHandle = null;
function startStatsSystem(){
  updateResourceUI();
  if (statsIntervalHandle) clearInterval(statsIntervalHandle);
  statsIntervalHandle = setInterval(()=>{
    HUNGER = Math.max(0, HUNGER - 2);
    if (HUNGER === 0) HEALTH = Math.max(0, HEALTH - 5);
    updateResourceUI();
  }, 10000);
}


  </script>
</body>
</html>
